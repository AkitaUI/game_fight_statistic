<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{{ page_title or "Game Stats" }}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet"
          href="{{ url_for('static', path='css/main.css') }}">
</head>
<body>
<header class="top-bar">
    <div class="container top-bar-inner">
        <div class="logo">
            <span class="logo-main">Game</span>
            <span class="logo-sub">Stats</span>
        </div>

        <nav class="main-nav">
            <a href="{{ request.url_for('index') }}"
               class="nav-link {% if request.url.path == '/' %}nav-link-active{% endif %}">
                Home
            </a>
            <a href="{{ request.url_for('players_page') }}"
               class="nav-link {% if request.url.path.startswith('/players') %}nav-link-active{% endif %}">
                Players
            </a>
            <a href="{{ request.url_for('battles_page') }}"
               class="nav-link {% if request.url.path.startswith('/battles') %}nav-link-active{% endif %}">
                Battles
            </a>
            <a href="{{ request.url_for('stats_page') }}"
               class="nav-link {% if request.url.path.startswith('/stats') %}nav-link-active{% endif %}">
                Stats
            </a>
            <a href="/docs"
               class="nav-link"
               target="_blank" rel="noopener">
                API docs
            </a>
        </nav>

        <div class="topbar-right" style="display:flex; gap:12px; align-items:center;">
            {% if enable_game_selector %}
            <div class="game-selector" style="display:flex; align-items:center; gap:8px;">
                <span style="font-size:0.9rem; opacity:0.85;">Game:</span>
                <select id="gameSelect" class="input" style="min-width: 180px;">
                    <option value="">Loading…</option>
                </select>
            </div>
            {% endif %}

            {% if enable_auth_ui %}
            <div class="auth-area" style="display:flex; align-items:center; gap:8px;">
                <span id="authStatus" style="font-size:0.9rem; opacity:0.9;"></span>
                <button id="btnLogin" class="btn" type="button">Login</button>
                <button id="btnRegister" class="btn btn-secondary" type="button">Register</button>
                <button id="btnLogout" class="btn btn-danger" type="button" style="display:none;">Logout</button>
                <span id="userInfo" class="auth-userinfo"></span>
                <span id="authRole" class="badge"></span>
            </div>
            {% endif %}
        </div>

    </div>
</header>

<main class="page-main">
    <div class="container">
        {% block content %}
        <section class="card">
            <h1>Welcome to Game Stats</h1>
            <p>Select a section in the top menu to start exploring players, battles and statistics.</p>
            <p style="opacity:0.8;">
                Tip: choose a game in the top-right selector. All API calls from UI should use the selected game.
            </p>
        </section>
        {% endblock %}
    </div>
</main>

<footer class="page-footer">
    <div class="container footer-inner">
        <span>Game Stats · Demo web UI</span>
        <span style="margin-left: 12px; font-size: 0.8rem;">
            <a href="/docs" target="_blank" rel="noopener">API docs</a> ·
            <a href="http://localhost:3000" target="_blank" rel="noopener">Grafana</a> ·
            <a href="http://localhost:5050" target="_blank" rel="noopener">pgAdmin</a>
        </span>
    </div>
</footer>

<!-- AUTH MODAL -->
<div id="authModal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,.45); z-index:9999;">
    <div style="max-width:420px; margin:8vh auto; background:#fff; border-radius:12px; padding:18px;">
        <div style="display:flex; justify-content:space-between; align-items:center; gap:12px;">
            <h3 id="authModalTitle" style="margin:0;">Login</h3>
            <button id="authModalClose" type="button" class="btn btn-secondary">X</button>
        </div>

        <div style="margin-top:12px; display:flex; flex-direction:column; gap:10px;">
            <label style="display:flex; flex-direction:column; gap:6px;">
                <span>Username</span>
                <input id="authUsername" class="input" type="text" autocomplete="username" />
            </label>

            <label style="display:flex; flex-direction:column; gap:6px;">
                <span>Password</span>
                <input id="authPassword" class="input" type="password" autocomplete="current-password" />
            </label>

            <div id="authModalHint" style="font-size:0.9rem; opacity:0.85;"></div>

            <div style="display:flex; gap:8px; justify-content:flex-end; margin-top:6px;">
                <button id="authSubmit" type="button" class="btn">Submit</button>
            </div>

            <div id="authError" style="display:none; color:#b00020; font-size:0.9rem;"></div>
        </div>
    </div>
</div>

<section id="adminPanel" style="display:none; margin-top:16px;">
  <h3>Admin panel</h3>

  <div style="display:flex; gap:12px; flex-wrap:wrap; align-items:flex-end;">
    <div>
      <label>New user username</label><br/>
      <input id="adminNewUsername" class="input" />
    </div>
    <div>
      <label>New user password</label><br/>
      <input id="adminNewPassword" class="input" type="password" />
    </div>
    <div>
      <label>Role</label><br/>
      <select id="adminNewRole" class="input">
        <option value="player">player</option>
        <option value="analyst">analyst</option>
        <option value="admin">admin</option>
      </select>
    </div>
    <button id="adminCreateUser" class="btn">Create user</button>
  </div>

  <hr style="margin:16px 0;" />

  <button id="adminReloadUsers" class="btn btn-secondary">Reload users</button>

  <table style="width:100%; margin-top:12px;" class="table">
    <thead>
      <tr><th>ID</th><th>Username</th><th>Role</th><th>Action</th></tr>
    </thead>
    <tbody id="adminUsersTbody"></tbody>
  </table>
</section>


<script>
  // Базовые константы для JS (main.js будет использовать)
  window.APP_CONFIG = {
    apiBase: "/api",
    gamesEndpoint: "/api/games",
    authRegisterEndpoint: "/api/auth/register",
    authTokenEndpoint: "/api/auth/token",
    storageKeys: {
      token: "access_token",
      gameId: "selected_game_id"
    }
  };
</script>

<script src="{{ url_for('static', path='js/main.js') }}"></script>
{% block extra_js %}{% endblock %}
</body>
</html>
