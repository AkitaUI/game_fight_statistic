{% extends "base.html" %}

{% block content %}
<section class="card">
    <div class="card-header">
        <h1>Player statistics</h1>
        <div class="card-actions">
            <span id="selected-game-badge" class="badge" style="display:none;"></span>
        </div>
    </div>

    <div class="card-body">
        <div id="game-required-warning" class="alert" style="display:none; margin-bottom: 12px;">
            Please select a game in the top-right selector before loading stats.
        </div>

        <div class="filters">
            <label>
                Player ID:
                <input type="number" id="stats-player-id" min="1" required>
            </label>
            <label>
                Ranked only:
                <input type="checkbox" id="stats-ranked-only">
            </label>
            <button id="load-player-stats-btn" class="btn">Load stats</button>
        </div>

        <div id="stats-summary-section" class="stats-section">
            <h2>Summary</h2>
            <pre id="stats-summary" class="pre-block"></pre>
        </div>

        <div id="stats-maps-section" class="stats-section">
            <h2>By maps</h2>
            <table class="data-table" id="stats-maps-table">
                <thead>
                <tr>
                    <th>Map</th>
                    <th>Battles</th>
                    <th>Wins</th>
                    <th>Losses</th>
                    <th>Draws</th>
                    <th>Win rate</th>
                    <th>Avg. kills</th>
                    <th>Avg. deaths</th>
                    <th>Avg. score</th>
                </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>

        <div id="stats-weapons-section" class="stats-section">
            <h2>By weapons</h2>
            <table class="data-table" id="stats-weapons-table">
                <thead>
                <tr>
                    <th>Weapon</th>
                    <th>Kills</th>
                    <th>Headshots</th>
                    <th>Accuracy</th>
                    <th>Usage count</th>
                </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>
</section>

<section class="card">
    <div class="card-header">
        <h2>Grafana dashboard</h2>
    </div>
    <div class="card-body">
        <p>
            Embedded Grafana dashboard with battles & players statistics.
            Для работы нужно, чтобы Grafana была запущена и была доступна по адресу <code>http://localhost:3000</code>.
        </p>
        <div class="grafana-frame-placeholder">
            <iframe
                src="http://localhost:3000/d/battles-stats/battles-players-statistics?orgId=1&refresh=30s"
                width="100%"
                height="420"
                frameborder="0">
            </iframe>
        </div>
    </div>
</section>

{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener("DOMContentLoaded", function () {
        window.GameStatsUI.initStatsPage();
    });
</script>
{% endblock %}
